# from https://stackoverflow.com/questions/59693655/building-tensorflow-from-source-with-docker

# docker run -it --rm -w /tensorflow_src -v $PWD:/mnt -e HOST_PERMS="$(id -u):$(id -g)" tensorflow/tensorflow:devel bash

FROM tensorflow/tensorflow:devel

# option 1
# wget https://github.com/llvm/llvm-project/releases/download/llvmorg-17.0.2/clang+llvm-17.0.2-x86_64-linux-gnu-ubuntu-22.04.tar.xz
# tar -xvf clang+llvm-17.0.2-x86_64-linux-gnu-ubuntu-22.04.tar.xz

# cp -r clang+llvm-17.0.2-x86_64-linux-gnu-ubuntu-22.04/* /usr
# clang --version

# option 2 

python -m pip uninstall tensorflow
apt update && install clang
git pull
git fetch --tags
git checkout v2.9.0
./configure
bazel build //tensorflow/tools/pip_package:build_pip_package --repo_env=WHEEL_NAME=tensorflow_cpu_2.9.0 --config=opt
./bazel-bin/tensorflow/tools/pip_package/build_pip_package ./tmp/tf_pkg
python -m pip install ./tmp/tf_pkg/*.whl

RUN python -c "import tensorflow as tf"


# TODO: use python container instead?



# bazel query //tensorflow/tools/pip_package:*
# bazel build //tensorflow/tools/pip_package:wheel --repo_env=WHEEL_NAME=tensorflow_cpu_2.15.0 --config=opt
# ./bazel-bin/tensorflow/tools/pip_package/build_pip_package ./tmp/tf_pkg
